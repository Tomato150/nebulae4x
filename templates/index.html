<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Index</title>

    <!-- Bootstrap stylesheet -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome stylesheet -->
    <link href="/static/font-awesome-4.6.1/css/font-awesome.min.css" rel="stylesheet">
    <!-- Custom stylesheet -->
    <link href="/static/css/custom.css" rel="stylesheet">

</head>
<body>

    <nav class="navbar navbar-toggleable-md fixed-top navbar-inverse bg-inverse" style="background-color: rgba(0, 0, 0, 0.75) !important;">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbar_content"><span class="navbar-toggler-icon"></span></button>
        <a class="navbar-brand" href="#" id="main-menu-div-toggle">Menu</a>
        <div id="navbar_content" class="collapse navbar-collapse" style="display: block">
            <ul class="navbar-nav mr-auto" style="">
                <li class="nav-item"><a class="nav-link navbar-main-menu-selectors" data-window-target="empire-menu" href="#">Empire Overview</a></li>
                <li class="nav-item"><a class="nav-link navbar-main-menu-selectors" data-window-target="system-menu" href="#">System Overview</a></li>
            </ul>
            <ul class="float-right navbar-nav mr-auto" style="margin: 0 !important;">
                <li class="nav-item"><a class="nav-link navbar-canvas-view-toggle" data-view-target="galaxy_canvas" href="#">Galaxy Viewer</a></li>
                <li class="nav-item"><a class="nav-link navbar-canvas-view-toggle" data-view-target="local_system_canvas" href="#">Local System Viewer</a></li>
            </ul>
        </div>
    </nav>

    <div id="main-menu-div" style="position: absolute; z-index: 2; background-color: rgba(255, 255, 255, 1); border-radius:0.75rem;">
        <div class="container-fluid">
            <div id="main-menu-header" style="margin: 10px;">
                <div class="row">
                    <div class="col-xl-12">
                        <h1 id="main-menu-header-title" style="display: inline-block;">Empire Window</h1>
                        <button id="main-menu-close" type="button" class="close"><span aria-hidden="true">&times;</span></button>
                    </div>
                </div>
            </div>

            <div id="main-menu-empire-screen">
                <div class="row">
                    <div id="empire-pill-navs" class="col-xl-12">
                        <ul class="nav nav-pills justify-content-center">
                            <!-- <li class="nav-item"><a href="#" class="nav-link" data-toggle="tab" role="tab"></a></li> -->
                            <li class="nav-item"><a href="#empire-overview" class="nav-link active" data-toggle="tab" role="tab">Overview</a></li>
                            <li class="nav-item"><a href="#empire-economy" class="nav-link" data-toggle="tab" role="tab">Economy</a></li>
                            <li class="nav-item"><a href="#empire-industry" class="nav-link" data-toggle="tab" role="tab">Industry</a></li>
                            <li class="nav-item"><a href="#empire-fleets" class="nav-link" data-toggle="tab" role="tab">Fleets</a></li>
                            <li class="nav-item"><a href="#empire-population" class="nav-link" data-toggle="tab" role="tab">Population</a></li>
                            <li class="nav-item"><a href="#empire-politics" class="nav-link" data-toggle="tab" role="tab">Politics</a></li>
                            <li class="nav-item"><a href="#empire-diplomacy" class="nav-link" data-toggle="tab" role="tab">Diplomacy</a></li>
                            <li class="nav-item"><a href="#empire-research" class="nav-link" data-toggle="tab" role="tab">Research</a></li>
                        </ul>

                        <div class="spacer-lg"></div>
                    </div>

                    <div id="empire-pill-contents" class="col-xl-12">
                        <div class="tab-content">
                            <!-- <div id="" class="tab-pane" role="tabpanel"></div> -->
                            <div id="empire-overview" class="tab-pane active" role="tabpanel">
                                <div class="row">
                                    <div class="col-xl-12">
                                        <h1>Empire Overview Tab</h1>
                                        <p>Useless information should go about ... Here</p>
                                    </div>
                                </div>
                            </div>

                            <div id="empire-economy" class="tab-pane" role="tabpanel">
                                <h1>Empire Economy Tabpanel</h1>
                                <p>Useless information should go about ... Here</p>
                            </div>

                            <div id="empire-industry" class="tab-pane" role="tabpanel">
                                <h1>Empire Industry Tabpanel</h1>
                                <p>Useless information should go about ... Here</p>
                            </div>

                            <div id="empire-fleets" class="tab-pane" role="tabpanel">
                                <h1>Empire Fleets Tabpanel</h1>
                                <p>Useless information should go about ... Here</p>
                            </div>

                            <div id="empire-population" class="tab-pane" role="tabpanel">
                                <h1>Empire Population Tabpanel</h1>
                                <p>Useless information should go about ... Here</p>
                            </div>

                            <div id="empire-politics" class="tab-pane" role="tabpanel">
                                <h1>Empire Politics Tabpanel</h1>
                                <p>Useless information should go about ... Here</p>
                            </div>

                            <div id="empire-diplomacy" class="tab-pane" role="tabpanel">
                                <h1>Empire Diplomacy Tabpanel</h1>
                                <p>Useless information should go about ... Here</p>
                            </div>

                            <div id="empire-research" class="tab-pane" role="tabpanel">
                                <h1>Empire Research Tabpanel</h1>
                                <p>Useless information should go about ... Here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="main-menu-system-screen" hidden>
                <div id="please-select">
                    <p>Please select a colony from the side</p>
                </div>
                <div id="main-menu-body" class="row">
                    <div id="system-pill-navs" class="col-xl-12" hidden>
                        <ul class="nav nav-pills justify-content-center">
                            <!-- <li class="nav-item"><a href="#" class="nav-link" data-toggle="tab" role="tab"></a></li> -->
                            <li class="nav-item"><a href="#system-overview" class="nav-link active" data-toggle="tab" role="tab">Overview</a></li>
                            <li class="nav-item"><a href="#system-economy" class="nav-link" data-toggle="tab" role="tab">Economy</a></li>
                            <li class="nav-item"><a href="#system-industry" class="nav-link" data-toggle="tab" role="tab">Industry</a></li>
                            <li class="nav-item"><a href="#system-fleets" class="nav-link" data-toggle="tab" role="tab">Fleets</a></li>
                            <li class="nav-item"><a href="#system-population" class="nav-link" data-toggle="tab" role="tab">Population</a></li>
                            <li class="nav-item"><a href="#system-politics" class="nav-link" data-toggle="tab" role="tab">Politics</a></li>
                            <li class="nav-item"><a href="#system-diplomacy" class="nav-link" data-toggle="tab" role="tab">Diplomacy</a></li>
                            <li class="nav-item"><a href="#system-research" class="nav-link" data-toggle="tab" role="tab">Research</a></li>
                        </ul>

                        <div class="spacer-lg"></div>
                    </div>

                    <div id="system-colony-selector-div" class="col-xl-2">
                        <div>
                            <h1>Colony Selector</h1>
                            <hr>
                            <table id="system-colony-table" class="table table-striped table-hover table-sm">
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <div id="system-pill-contents" class="col-xl-10" hidden>
                        <div class="tab-content">
                            <!-- <div id="" class="tab-pane" role="tabpanel"></div> -->
                            <div id="system-overview" class="tab-pane active" role="tabpanel">
                                <div class="row">
                                    <div class="col-xl-12">
                                        <h1>System Overview Tab</h1>
                                        <p>Useless information about System Stuff should go about ... Here</p>
                                    </div>
                                </div>
                            </div>

                            <div id="system-economy" class="tab-pane" role="tabpanel">
                                <h1>System Economy Tabpanel</h1>
                                <p>Useless information should go about ... Here</p>
                            </div>

                            <div id="system-industry" class="tab-pane" role="tabpanel">
                                <h1>System Industry Tabpanel</h1>
                                <p>Useless information should go about ... Here</p>
                                <div class="row">
                                    <div id="construction-project-table" class="col-xl-12">

                                    </div>

                                    <div id="create-new-project-menu" class="col-xl-12">
                                        <div class="row">
                                            <div id="buildings-list" class="col-xl-2">
                                                <table class="table table-sm table-striped">
                                                    <tbody>
                                                        <tr><td class="selectable-building">Factory</td></tr>
                                                        <tr><td class="selectable-building" >Mine</td></tr>
                                                    </tbody>
                                                </table>
                                            </div>

                                            <div id="construction-project-settings" class="col-xl-6">
                                                <form>
                                                    <fieldset disabled>
                                                        <div class="form-group row" style="margin-bottom: 6px;">
                                                            <label class="col-2 col-form-label col-form-label-sm" for="construction-project-building">Building</label>
                                                            <div class="col-10">
                                                                <input id="construction-project-building" class="form-control form-control-sm" type="text">
                                                                <small class="form-text text-muted" style="margin-top: 0">The type of building.</small>
                                                            </div>
                                                        </div>
                                                    </fieldset>
                                                    <div class="form-group row" style="margin-bottom: 6px;">
                                                        <label class="col-2 col-form-label col-form-label-sm" for="construction-project-runs">Runs</label>
                                                        <div class="col-10">
                                                            <input id="construction-project-runs" class="form-control form-control-sm" type="text">
                                                            <small class="form-text text-muted" style="margin-top: 0">The amount you wish to create.</small>
                                                        </div>
                                                    </div>
                                                    <div class="form-group row">
                                                        <label class="col-2 col-form-label col-form-label-sm" for="construction-project-factories">Factories</label>
                                                        <div class="col-10">
                                                            <input id="construction-project-factories" class="form-control form-control-sm" type="text">
                                                            <small class="form-text text-muted" style="margin-top: 0">The amount of factories you wish to assign to the project.</small>
                                                        </div>
                                                    </div>
                                                    <button id="construction-project-creation" type="submit" class="btn btn-primary">Submit</button>
                                                </form>
                                            </div>

                                            <div id="construction-project-stats" class="col-xl-4">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="system-fleets" class="tab-pane" role="tabpanel">
                                <h1>System Fleets Tabpanel</h1>
                                <p>Useless information should go about ... Here</p>
                            </div>

                            <div id="system-population" class="tab-pane" role="tabpanel">
                                <h1>System Population Tabpanel</h1>
                                <p>Useless information should go about ... Here</p>
                            </div>

                            <div id="system-politics" class="tab-pane" role="tabpanel">
                                <h1>System Politics Tabpanel</h1>
                                <p>Useless information should go about ... Here</p>
                            </div>

                            <div id="system-diplomacy" class="tab-pane" role="tabpanel">
                                <h1>System Diplomacy Tabpanel</h1>
                                <p>Useless information should go about ... Here</p>
                            </div>

                            <div id="system-research" class="tab-pane" role="tabpanel">
                                <h1>System Research Tabpanel</h1>
                                <p>Useless information should go about ... Here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>




    <div id="viewport" class="" style="position: fixed; overflow: hidden; height: 100vh; width: 100vw;">
        <canvas id="canvas"></canvas>
    </div>

    <!-- Bootstrap Dependencies -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="/static/js/jquery-2.2.1.min.js"></script>
    <!-- Tether -->
    <script src="/static/js/tether/js/tether.min.js"></script>

    <!-- Bootstrap -->
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/static/js/bootstrap.min.js"></script>

    <!-- Personally chosen plugins -->
    <script src="/static/js/pixi.min.js"></script>
    <script src="/static/js/jsrender.min.js"></script>

    <script src="/static/js/world.js"></script>

    <script src="/static/js/handlers/mouse.js"></script>

    <script src="/static/js/handlers.js"></script>

    {% raw %}
    <script id="construction-project-table-template" type="text/x-jsrender">

    </script>
    {% endraw %}

    <script>
        $(document).ready(function () {
            var world = world_object;

            var mouse_handlers = handler_object;

            var handlers = handler_object;

            function Command(name, args) {
                this.name = name;
                this.args = args;
            }

            $.ajax({
                type: 'GET',
                url: '/get_objects',
                dataType: 'json',
                contentType: 'application/json',
                success: function (server_data) {
                    world.init(server_data);
                },
                error: function (xhr, ajaxOptions, thrownError) {alert('Error: Unable to load objects from server: ' + thrownError);}
            });

            // Mouse Scroll on canvas.
            $(document).on('mousewheel', '#canvas', function (e) {mouse_handlers.mouse_scroll(e, world);});

            // Dragging Canvas
            $(document).on('mousedown', '#canvas', function (e) {mouse_handlers.canvas_mouse_click(e, world);});

            // Double click to select planet.
            $(document).on('dblclick', '#canvas', function (e) {mouse_handlers.galaxy_double_click(e, world);});

            // Mouse move on canvas.
            $(document).on('mousemove', function (e) {mouse_handlers.mouse_move(e, world);} );

            // Releasing mouse button
            $(document).on('mouseup', function (e) {mouse_handlers.mouse_click_up(e, world);} );

            // TODO Move all to separate files.
            // Main menu header button
            $(document).on('click', '#main-menu-div-toggle', function (e) {
                e.preventDefault();
                var main_menu = $('#main-menu-div');
                if (main_menu.attr('hidden')) {
                    main_menu.removeAttr('hidden')
                } else {
                    main_menu.attr({'hidden': ''})
                }
            });

            // Cross button for main menu
            $(document).on('click', '#main-menu-close', function () {
                $('#main-menu-div').attr({'hidden': ''})
            });

            // Set which view is visible
            $(document).on('click', '.navbar-main-menu-selectors', function (e) {
                e.preventDefault();
                var data_window_target = $(this).data('window-target');
                world.set_menu_for(data_window_target)
            });

            // Change galactic view
            $(document).on('click', '.navbar-canvas-view-toggle', function (e) {
                e.preventDefault();
                var view_target = $(this).data('view-target');
                world.set_view_for(view_target)
            });

            // Create construction project
            $(document).on('click', '#construction-project-creation', function (e) {
                e.preventDefault();
                var config = world.get_config();
                var command = new Command('start_construction_project', [
                    config.selected_colony.ids,
                    [
                        $('#construction-project-building').val().toLowerCase(),
                        $('#construction-project-runs').val(),
                        $('#construction-project-factories').val()
                    ]
                ]);
                console.log(command);
                world.post_commands_to_server(command);
            });

            // Right click
            $(document).on('contextmenu', '#canvas', function (e) {
                e.preventDefault();
                var config = world.get_config();
                console.log(Math.floor((config.container_pan_x + config.mouse_x) / config.scroll_factor - (config.canvas_size / 2)));
                console.log(-Math.floor((config.container_pan_y + config.mouse_y) / config.scroll_factor - (config.canvas_size / 2)));
            });

            // Select a colony from sidebar
            $(document).on('click', '.colony-selector', function (e) {
                e.preventDefault();

                var system_resource_table = $('#colony-resources-table');

                var colony_id = $(this).data('colony-id');
                var config = world.get_config();

                var colony = config.empires['0'].colonies[colony_id];
                config.selected_colony = colony;

                world.set_menu_for('colony')
            });

            // Select building from sidebar.
            $(document).on('click', '.selectable-building', function (e) {
                e.preventDefault();
                $('#construction-project-building').val(($(this).text()));
            });
        });
    </script>
</body>
</html>